- 熟悉功率管理和电源管理的相关模块
	- 单板和子卡的功率分配流程
	- 电源关断和开启流程
	- 电源状态转换过程
- 主要工作内容
	- 新增电源shutdown状态
	- 如何判断是否需要进行动态调整电源状态（<mark style="background: #FFB86CA6;">不考虑已配置的冗余电源数</mark>）保持电源数在N+1(N：保证所有单板正常工作所需要的最小电源数)
	- 主备倒换同步电源状态
	- 处理涉及电源功率相关的命令显示
	- 处理涉及电源模块的trap告警
	- 涉及命令的相关改动：
		- 在1号电源关断的情况下：
	```vim
	<H3C>dis hardware power chassis 1 slot 8
	Power No.   Tray Index/Power Index      State       Type          Current(A)  Voltage(V)  Power(W)    UpdateMode
	----------------------------------------------------------------------------------------------------------------
	1/1          0/1                        shutdown      PSR2400-54A          0         0         0        N
	
	```
	新增电源<mark style="background: #FF5582A6;">shutdown</mark>状态
	```vim
	<H3C>dis power                                                                                                                                      
	Chassis     InPower(W)     OutPower(W)                                                                                                              
	----------------------------------------------                                                                                                      
	1           610            536.78                                                                                                                   
	PowerID.    State     Type            InVoltage(V)   InPower(W)    OutVoltage(V)  OutCurrent(A)  OutPower(W)                                        
	----------------------------------------------------------------------------------------------------------------                                    
	1/1         Normal    PSR2400-54A     236            0.00           0.00           0.00           0.00                                                  
	```
	平台获取的电源状态为<mark style="background: #FF5582A6;">normal，InPower为0</mark>
	```vim
	<H3C>display hardware power-management chassis 1 slot 8                                                                                             
	System Power Active      : 4800 watts
	System Power Shutdown    : 2400 watts
	System Power Allocated   : 1795 watts
	System Power Available   : 605  watts
	System Power Per Unit    : 2400 watts
	System Power Reserved    : 1662 watts
	System Power Redundant   : 2400 watts
	System Power Compatible  : Yes
	System Power Permission  : Yes
	System Power AlarmFlag   : 0x00000000
	```
	增加字段<mark style="background: #FF5582A6;">Shutdown</mark>，用来支持查询当前关断的电源数；
	Shutdown的功率不计算在Available中；
	原来的Total字段改成Active，表示处于工作状态的可用功率。
- 编码方案（定时器检测，电源关断开启，状态调整）
	- pwrm.c
		- 主控初次启动该特性不生效
		- 增加定时器，监控系统冗余电源情况
			- 在PWRM_MNG_S中增加定时器stCheckRedunPowerTimer，通过<code>pwrm_KqueWrite</code>定时向队列写消息**PWRM_KQUE_MSG_CHECK_REDUN_POWER**，触发处理检查冗余电源<code>pwrm_RedunPowerCheck</code>
			- 通过<code>pwrm_GetMaxRedun</code>获取最大冗余电源数，判断是否需要开启或关断电源
			```c
			if (pwrm_GetMaxRedun == 0)
			{
				if(pwrm_GetShutDown() > 0)
					POWER_RedunDown();
			}
			else if (pwrm_GetMaxRedun > 1)
			{
					POWER_RedunUp();
			}
			```
			- 保证系统稳定运行，单次只关断/开启一个冗余电源
		- 单板处于wait状态需要分配功率的过程中需要触发冗余功率的计算
			- 在Available功率不足时，判断ShutDown的功率是否为0，来决定是否触发开启冗余电源的动作
		- 增加接口<code>pwrm_GetShutPower</code>获取被关断的电源数
	- power.c
		- 在POWER_S增加标志位bShutDown，区分电源在error状态下是否为主动关断的电源
		- 增加<code>POWER_GetReunPowerNum</code>
		  ```
		```
		- 新增电源关断接口<code>POWER_RedunDown</code>
		>遍历电源，写命令字关断第一个normal的电源
		- 新增电源开启接口<code>POWER_RedunUp</code>
		> 遍历电源，写命令字开启第一个bShutDown标志位为true的电源
		- 主备倒换同步电源状态
- 本地测试
	- 工作电源数需要动态开启的场景
	- 工作电源数需要动态关断的场景
	- 主备倒换同步状态
	- 相关命令显示
- 合入主线
- 遗留问题：
	- 电源关断后，告警灯亮
	- 关断电源后状态与平台不一致，平台状态保持normal

$$
\begin{Bmatrix}
   c & 1 \\
   1 & dk
\end{Bmatrix}
$$
$$
\begin{CD}
   A @>>> K \\
@VVV @AAA \\
   C @>>> D
\end{CD}
$$